---
// src/components/ThemeToggle.astro
// No se necesita frontmatter
---

<button
  class="theme-toggle-btn flex size-10 items-center justify-center rounded-full text-foreground hover:bg-muted/10 transition-colors cursor-pointer"
  aria-label="Toggle dark/light theme"
  title="Toggle dark/light theme"
>
  <span class="material-symbols-outlined !text-2xl theme-icon">
    contrast
  </span>
</button>

<script>
  // Script habilitado para View Transitions
  function initThemeToggle() {
    const storageKey = 'theme-preference';
    const classDark = 'dark';
    const btnClass = '.theme-toggle-btn';
    const iconClass = '.theme-icon';

    function getThemePreference() {
      return document.documentElement.classList.contains(classDark) ? 'dark' : 'light';
    }

    function applyTheme(theme) {
      const isDark = theme === 'dark';
      document.documentElement.classList.toggle(classDark, isDark);
      
      const icons = document.querySelectorAll(iconClass);
      icons.forEach(icon => {
        icon.textContent = isDark ? 'dark_mode' : 'light_mode';
      });
    }

    // Actualizar UI inicial
    applyTheme(getThemePreference());

    const buttons = document.querySelectorAll(btnClass);
    buttons.forEach(btn => {
      // Remover listeners previos si existen para evitar duplicados (opcional pero seguro)
      const newBtn = btn.cloneNode(true);
      btn.parentNode.replaceChild(newBtn, btn);
      
      newBtn.addEventListener('click', () => {
        const currentTheme = getThemePreference();
        const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
        applyTheme(newTheme);
        localStorage.setItem(storageKey, newTheme);
      });
    });
  }

  // Ejecutar en cada navegaci√≥n
  document.addEventListener('astro:page-load', initThemeToggle);
</script>